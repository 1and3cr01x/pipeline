#!/bin/bash
echo 'Deleting environment...'
echo "PIO_MODEL_NAMESPACE=$PIO_MODEL_NAMESPACE"
echo "PIO_MODEL_NAME=$PIO_MODEL_NAME"
echo "PIO_MODEL_VERSION=$PIO_MODEL_VERSION"
echo "PIO_MODEL_FILENAME=$PIO_MODEL_FILENAME"
echo "PIO_MODEL_SERVER_PORT=$PIO_MODEL_SERVER_PORT"
echo "STORE_HOME=$STORE_HOME"
delete_environment

export PIO_MODEL_VERSION=$(ls $STORE_HOME/$PIO_MODEL_NAMESPACE/$PIO_MODEL_NAME/ | sort -nr | sed -n 1p)

create_environment
source activate "${PIO_MODEL_NAMESPACE}_${PIO_MODEL_NAME}_${PIO_MODEL_VERSION}"

export PIO_MODEL_VERSION=$(ls $STORE_HOME/$PIO_MODEL_NAMESPACE/$PIO_MODEL_NAME/ | sort -nr | sed -n 1p)
export PIO_MODEL_FILENAME=$(ls $STORE_HOME/$PIO_MODEL_NAMESPACE/$PIO_MODEL_NAME/$PIO_MODEL_VERSION/ | grep .pkl | sed
-n 1p)
export PIO_MODEL_SERVER_PORT=9876

echo 'Creating environment...'
echo "PIO_MODEL_NAMESPACE=$PIO_MODEL_NAMESPACE"
echo "PIO_MODEL_NAME=$PIO_MODEL_NAME"
echo "PIO_MODEL_VERSION=$PIO_MODEL_VERSION"
echo "PIO_MODEL_FILENAME=$PIO_MODEL_FILENAME"
echo "PIO_MODEL_SERVER_PORT=$PIO_MODEL_SERVER_PORT"
echo "STORE_HOME=$STORE_HOME"

PYTHONPATH=$STORE_HOME/$PIO_MODEL_NAMESPACE/$PIO_MODEL_NAME/$PIO_MODEL_VERSION/:$PYTHONPATH src/main/python/scikit/sta
rt_model_server.py $PIO_MODEL_SERVER_PORT $STORE_HOME/$PIO_MODEL_NAMESPACE/$PIO_MODEL_NAME/$PIO_MODEL_VERSION/$PIO_MOD
EL_FILENAME
